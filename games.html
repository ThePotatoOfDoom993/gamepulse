<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Games - GamePulse</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .games-container {
            padding: 100px 20px 50px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .games-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .games-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .view-toggle {
            display: flex;
            background: var(--bg-secondary);
            padding: 4px;
            border-radius: 8px;
            border: 1px solid #333;
        }
        
        .view-btn {
            padding: 8px 16px;
            border: none;
            background: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 6px;
            transition: var(--transition);
        }
        
        .view-btn.active {
            background: var(--accent-primary);
            color: var(--bg-primary);
        }
        
        .filter-select {
            padding: 8px 16px;
            background: var(--bg-secondary);
            border: 1px solid #333;
            border-radius: 6px;
            color: var(--text-primary);
        }
        
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .game-card {
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            border: 1px solid #333;
            overflow: hidden;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-primary);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .game-cover {
            height: 150px;
            background: linear-gradient(45deg, #333, #555);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }
        
        .game-info {
            padding: 1.5rem;
        }
        
        .game-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        .game-meta {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .game-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .playtime {
            color: var(--accent-primary);
            font-weight: 600;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-playing {
            background: rgba(0, 255, 136, 0.2);
            color: var(--accent-primary);
        }
        
        .status-completed {
            background: rgba(0, 136, 255, 0.2);
            color: var(--accent-secondary);
        }
        
        .status-backlog {
            background: rgba(255, 165, 0, 0.2);
            color: #ffa500;
        }
        
        .add-game-section {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: var(--border-radius);
            border: 1px solid #333;
            margin-bottom: 2rem;
        }
        
        .search-game {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .search-game input {
            flex: 1;
            padding: 12px;
            background: var(--bg-primary);
            border: 1px solid #333;
            border-radius: 6px;
            color: var(--text-primary);
        }
        
        .game-suggestions {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .suggestion-card {
            background: var(--bg-primary);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #333;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .suggestion-card:hover {
            border-color: var(--accent-primary);
        }
        
        .logout-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }
        
        .empty-state h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo" data-glitch onclick="location.href='index.html'">GAMEPULSE</div>
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-link">Dashboard</a>
                <a href="games.html" class="nav-link active">My Games</a>
                <a href="blogs.html" class="nav-link">Blogs</a>
                <a href="profile.html" class="nav-link">Profile</a>
                <!-- Dynamic links based on role -->
                <span id="roleLinks"></span>
            </div>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </nav>

    <div class="games-container">
        <div class="games-header">
            <h1 class="section-title">My Game Library</h1>
            <button class="btn primary" onclick="showAddGame()">+ Add Game</button>
        </div>
        
        <!-- Add Game Section -->
        <div class="add-game-section" id="addGameSection" style="display: none;">
            <h3>Add New Game</h3>
            <div class="search-game">
                <input type="text" id="gameSearch" placeholder="Search for a game..." onkeyup="searchGames()">
                <button class="btn secondary" onclick="searchGames()">Search</button>
            </div>
            <div class="game-suggestions" id="gameSuggestions">
                <!-- Game suggestions will appear here -->
            </div>
            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #333;">
                <h4>Or add custom game:</h4>
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                    <input type="text" id="customTitle" placeholder="Game title">
                    <select id="customPlatform">
                        <option value="">Platform</option>
                        <option value="PC">PC</option>
                        <option value="PlayStation">PlayStation</option>
                        <option value="Xbox">Xbox</option>
                        <option value="Nintendo Switch">Nintendo Switch</option>
                        <option value="Mobile">Mobile</option>
                        <option value="Multiplatform">Multiplatform</option>
                    </select>
                    <select id="customGenre">
                        <option value="">Genre</option>
                        <option value="Action">Action</option>
                        <option value="Adventure">Adventure</option>
                        <option value="RPG">RPG</option>
                        <option value="Shooter">Shooter</option>
                        <option value="Strategy">Strategy</option>
                        <option value="Sports">Sports</option>
                        <option value="Racing">Racing</option>
                        <option value="Sandbox">Sandbox</option>
                    </select>
                </div>
                <button class="btn primary" onclick="addCustomGame()" style="margin-top: 1rem;">Add Custom Game</button>
            </div>
        </div>
        
        <!-- Games Controls -->
        <div class="games-controls">
            <div class="view-toggle">
                <button class="view-btn active" onclick="filterGames('all')">All Games</button>
                <button class="view-btn" onclick="filterGames('playing')">Playing</button>
                <button class="view-btn" onclick="filterGames('completed')">Completed</button>
                <button class="view-btn" onclick="filterGames('backlog')">Backlog</button>
            </div>
            <select class="filter-select" onchange="sortGames(this.value)">
                <option value="recent">Recently Added</option>
                <option value="title">Title A-Z</option>
                <option value="playtime">Most Playtime</option>
                <option value="recently-played">Recently Played</option>
            </select>
        </div>
        
        <!-- Games Grid -->
        <div class="games-grid" id="gamesGrid">
            <!-- Games will be populated here -->
        </div>
        
        <!-- Empty State -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <h3>No games in your library yet</h3>
            <p>Start by adding some games to track your gaming journey!</p>
            <button class="btn primary" onclick="showAddGame()" style="margin-top: 1rem;">Add Your First Game</button>
        </div>
    </div>

    <script src="scripts/script.js"></script>
    <script>
        // Check authentication
        const currentUser = JSON.parse(localStorage.getItem('user')) || JSON.parse(localStorage.getItem('demoUser'));
        if (!currentUser) {
            window.location.href = 'login.html';
        }

        let currentView = 'all';
        let currentSort = 'recent';

        // Initialize gaming data
        function initializeGamingData() {
            if (!localStorage.getItem('userGames')) {
                localStorage.setItem('userGames', JSON.stringify([]));
            }
            if (!localStorage.getItem('gameLibrary')) {
                const sampleGames = [
                    { id: 1, title: "The Legend of Zelda: Tears of the Kingdom", platform: "Nintendo Switch", genre: "Adventure", cover: "🗡️" },
                    { id: 2, title: "Baldur's Gate 3", platform: "PC", genre: "RPG", cover: "🐉" },
                    { id: 3, title: "Cyberpunk 2077", platform: "Multiplatform", genre: "RPG", cover: "🔫" },
                    { id: 4, title: "Minecraft", platform: "Multiplatform", genre: "Sandbox", cover: "⛏️" },
                    { id: 5, title: "Roblox", platform: "Multiplatform", genre: "Social", cover: "🧱" },
                    { id: 6, title: "Fortnite", platform: "Multiplatform", genre: "Battle Royale", cover: "💥" },
                    { id: 7, title: "Elden Ring", platform: "Multiplatform", genre: "RPG", cover: "👑" },
                    { id: 8, title: "Grand Theft Auto V", platform: "Multiplatform", genre: "Action", cover: "🚗" }
                ];
                localStorage.setItem('gameLibrary', JSON.stringify(sampleGames));
            }
        }

        function loadGames() {
            const userGames = JSON.parse(localStorage.getItem('userGames') || '[]');
            const gamesGrid = document.getElementById('gamesGrid');
            const emptyState = document.getElementById('emptyState');
            
            if (userGames.length === 0) {
                gamesGrid.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            
            gamesGrid.style.display = 'grid';
            emptyState.style.display = 'none';
            
            // Filter games based on current view
            let filteredGames = userGames;
            if (currentView !== 'all') {
                filteredGames = userGames.filter(game => game.status === currentView);
            }
            
            // Sort games
            filteredGames.sort((a, b) => {
                switch (currentSort) {
                    case 'title':
                        return a.title.localeCompare(b.title);
                    case 'playtime':
                        return (b.playtime || 0) - (a.playtime || 0);
                    case 'recently-played':
                        return new Date(b.lastPlayed || 0) - new Date(a.lastPlayed || 0);
                    case 'recent':
                    default:
                        return new Date(b.addedDate || 0) - new Date(a.addedDate || 0);
                }
            });
            
            // Display games
            gamesGrid.innerHTML = filteredGames.map(game => `
                <div class="game-card" onclick="viewGame(${game.id})">
                    <div class="game-cover">${game.cover || '🎮'}</div>
                    <div class="game-info">
                        <h3 class="game-title">${game.title}</h3>
                        <div class="game-meta">${game.platform} • ${game.genre}</div>
                        <div class="game-stats">
                            <div class="playtime">${game.playtime || 0}h</div>
                            <div class="status-badge status-${game.status}">
                                ${getStatusText(game.status)}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getStatusText(status) {
            const statusMap = {
                'playing': 'Playing',
                'completed': 'Completed',
                'backlog': 'Backlog'
            };
            return statusMap[status] || status;
        }

        function filterGames(view) {
            currentView = view;
            
            // Update active button
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadGames();
        }

        function sortGames(sortBy) {
            currentSort = sortBy;
            loadGames();
        }

        function showAddGame() {
            const addGameSection = document.getElementById('addGameSection');
            addGameSection.style.display = addGameSection.style.display === 'none' ? 'block' : 'none';
            loadGameSuggestions();
        }

        function loadGameSuggestions() {
            const gameLibrary = JSON.parse(localStorage.getItem('gameLibrary') || '[]');
            const userGames = JSON.parse(localStorage.getItem('userGames') || '[]');
            const userGameIds = userGames.map(game => game.libraryId).filter(id => id);
            
            // Show games not already in user's library
            const availableGames = gameLibrary.filter(game => !userGameIds.includes(game.id));
            
            const suggestionsContainer = document.getElementById('gameSuggestions');
            suggestionsContainer.innerHTML = availableGames.map(game => `
                <div class="suggestion-card" onclick="addGameFromLibrary(${game.id})">
                    <div style="font-size: 2rem; text-align: center; margin-bottom: 0.5rem;">${game.cover}</div>
                    <div style="text-align: center;">
                        <strong>${game.title}</strong><br>
                        <small style="color: var(--text-secondary);">${game.platform} • ${game.genre}</small>
                    </div>
                </div>
            `).join('');
        }

        function searchGames() {
            const searchTerm = document.getElementById('gameSearch').value.toLowerCase();
            const gameLibrary = JSON.parse(localStorage.getItem('gameLibrary') || '[]');
            const userGames = JSON.parse(localStorage.getItem('userGames') || '[]');
            const userGameIds = userGames.map(game => game.libraryId).filter(id => id);
            
            const filteredGames = gameLibrary.filter(game => 
                !userGameIds.includes(game.id) &&
                game.title.toLowerCase().includes(searchTerm)
            );
            
            const suggestionsContainer = document.getElementById('gameSuggestions');
            suggestionsContainer.innerHTML = filteredGames.map(game => `
                <div class="suggestion-card" onclick="addGameFromLibrary(${game.id})">
                    <div style="font-size: 2rem; text-align: center; margin-bottom: 0.5rem;">${game.cover}</div>
                    <div style="text-align: center;">
                        <strong>${game.title}</strong><br>
                        <small style="color: var(--text-secondary);">${game.platform} • ${game.genre}</small>
                    </div>
                </div>
            `).join('');
        }

        function addGameFromLibrary(libraryId) {
            const gameLibrary = JSON.parse(localStorage.getItem('gameLibrary') || '[]');
            const userGames = JSON.parse(localStorage.getItem('userGames') || '[]');
            
            const libraryGame = gameLibrary.find(game => game.id === libraryId);
            if (!libraryGame) return;
            
            const newGame = {
                id: Date.now(),
                libraryId: libraryId,
                title: libraryGame.title,
                platform: libraryGame.platform,
                genre: libraryGame.genre,
                cover: libraryGame.cover,
                status: 'backlog',
                playtime: 0,
                addedDate: new Date().toISOString(),
                lastPlayed: null
            };
            
            userGames.push(newGame);
            localStorage.setItem('userGames', JSON.stringify(userGames));
            
            // Add activity
            addActivity('game_added', `Added ${libraryGame.title} to library`);
            
            // Hide add game section and reload
            document.getElementById('addGameSection').style.display = 'none';
            loadGames();
            
            alert(`Added ${libraryGame.title} to your library!`);
        }

        function addCustomGame() {
            const title = document.getElementById('customTitle').value.trim();
            const platform = document.getElementById('customPlatform').value;
            const genre = document.getElementById('customGenre').value;
            
            if (!title || !platform || !genre) {
                alert('Please fill in all fields');
                return;
            }
            
            const userGames = JSON.parse(localStorage.getItem('userGames') || '[]');
            const newGame = {
                id: Date.now(),
                title: title,
                platform: platform,
                genre: genre,
                cover: '🎮',
                status: 'backlog',
                playtime: 0,
                addedDate: new Date().toISOString(),
                lastPlayed: null
            };
            
            userGames.push(newGame);
            localStorage.setItem('userGames', JSON.stringify(userGames));
            
            // Add activity
            addActivity('game_added', `Added ${title} to library`);
            
            // Clear form and hide section
            document.getElementById('customTitle').value = '';
            document.getElementById('customPlatform').value = '';
            document.getElementById('customGenre').value = '';
            document.getElementById('addGameSection').style.display = 'none';
            loadGames();
            
            alert(`Added ${title} to your library!`);
        }

        function viewGame(gameId) {
            window.location.href = `game-details.html?id=${gameId}`;
        }

        function addActivity(type, message) {
            const gamingActivity = JSON.parse(localStorage.getItem('gamingActivity') || '[]');
            gamingActivity.unshift({
                type: type,
                message: message,
                timestamp: new Date().toISOString()
            });
            // Keep only last 50 activities
            localStorage.setItem('gamingActivity', JSON.stringify(gamingActivity.slice(0, 50)));
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('user');
                localStorage.removeItem('demoUser');
                window.location.href = 'login.html';
            }
        }

        // Update navigation based on user role
        function updateNavigation() {
            const roleLinks = document.getElementById('roleLinks');
            if (currentUser.role === 'admin' || currentUser.role === 'owner') {
                roleLinks.innerHTML = '<a href="admin.html" class="nav-link">Admin</a>';
            } else if (['content-creator', 'youth-mentor'].includes(currentUser.role)) {
                roleLinks.innerHTML = '<a href="create-blog.html" class="nav-link">Create Blog</a>';
            }
        }

        // Initialize and load games
        document.addEventListener('DOMContentLoaded', function() {
            initializeGamingData();
            loadGames();
            updateNavigation();
        });
    </script>
</body>
</html>